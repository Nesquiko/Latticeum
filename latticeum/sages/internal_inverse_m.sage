p = 2 ^ 64 - 2 ^ 32 + 1
F = GF(p)

INTERNAL = vector(
    F,
    [
        6829280927315210738,
        12268062495221155140,
        13566740668459520841,
        3898457950037656553,
        11492207417558777945,
        11156586730023474729,
        1611574972052613985,
        8757309153920058853,
        16173054648362138220,
        5081134865904393435,
        5216324156727791157,
        1622965466512268548,
        15399964748491441698,
        13901234455471868173,
        7308440905447822553,
        9840330994579376767,
        17628857825211021054,
        4429510659353245516,
        15790356514736528643,
        1519916994673379586,
        3994020779470435763,
        9770397865355724868,
    ],
)

DIAG = vector(
    F,
    [
        0xDE9B91A467D6AFC0,
        0xC5F16B9C76A9BE17,
        0x0AB0FEF2D540AC55,
        0x3001D27009D05773,
        0xED23B1F906D3D9EB,
        0x5CE73743CBA97054,
        0x1C3BAB944AF4BA24,
        0x2FAA105854DBAFAE,
        0x53FFB3AE6D421A10,
        0xBCDA9DF8884BA396,
        0xFC1273E4A31807BB,
        0xC77952573D5142C0,
        0x56683339A819B85E,
        0x328FCBD8F0DDC8EB,
        0xB5101E303FCE9CB7,
        0x774487B8C40089BB,
    ],
)

D = matrix(F, len(DIAG), len(DIAG), [1] * (len(DIAG) * len(DIAG)))
for i in range(len(DIAG)):
    D[i, i] = DIAG[i] + 1

D_INV = D.inverse()

s_in = vector(
    F,
    [
        13335950288334696394,
        476861232930237825,
        1240148612850918248,
        447160000063433649,
        16291985968021491990,
        14695953806508273517,
        1040650807956338460,
        3535839109234190549,
        2172489798458060558,
        10906554185115510494,
        4456691934060896378,
        16326768908608229596,
        18435365110967315542,
        1445115818044747014,
        12619422748398501321,
        8226883782165653832,
    ],
)

s_0 = (s_in[0] + INTERNAL[0]) ** 7
s_in_0 = vector(F, [s_0] + list(s_in[1:]))


def matmul(s):
    s = vector(F, list(s))
    s_sum = sum(s)
    for i in range(0, len(s)):
        s[i] *= DIAG[i]
        s[i] += s_sum

    return s


# s_matmul = matmul(s_in_0)
# print(s_matmul == s_in_0 * D)
# print(s_matmul * D_INV == s_in_0)

print(D_INV.transpose())
